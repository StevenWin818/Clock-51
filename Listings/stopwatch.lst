C51 COMPILER V9.60.7.0   STOPWATCH                                                         11/18/2025 22:05:12 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE STOPWATCH
OBJECT MODULE PLACED IN .\Objects\stopwatch.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE stopwatch.c ROM(COMPACT) OPTIMIZE(8,SPEED) PRINT(.\Listings\stopwatch.ls
                    -t) TABS(2) OBJECT(.\Objects\stopwatch.obj)

line level    source

   1          #include "stopwatch.h"
   2          #include "clock.h"
   3          
   4          // 全局秒表变量 - 优化内存分配
   5          Stopwatch idata g_stopwatch = {0UL, SW_STOPPED};
   6          LapRecord idata g_laps[MAX_LAP_COUNT];
   7          unsigned char idata g_lap_count = 0;
   8          unsigned char idata g_lap_view_page = 0;
   9          
  10          // 秒表初始化
  11          void Stopwatch_Init(void) {
  12   1          g_stopwatch.ticks = 0UL;
  13   1          g_stopwatch.state = SW_STOPPED;
  14   1          g_lap_count = 0;
  15   1          g_lap_view_page = 0;
  16   1      }
  17          
  18          // 秒表更新 (每10ms调用一次)
  19          void Stopwatch_Update(void) {
  20   1          if(g_stopwatch.state == SW_RUNNING) {
  21   2              g_stopwatch.ticks++;
  22   2          }
  23   1      }
  24          
  25          // 启动秒表
  26          void Stopwatch_Start(void) {
  27   1          g_stopwatch.state = SW_RUNNING;
  28   1      }
  29          
  30          // 暂停秒表
  31          void Stopwatch_Pause(void) {
  32   1          g_stopwatch.state = SW_PAUSED;
  33   1      }
  34          
  35          // 清零秒表
  36          void Stopwatch_Clear(void) {
  37   1          g_stopwatch.ticks = 0UL;
  38   1          g_stopwatch.state = SW_STOPPED;
  39   1          g_lap_count = 0;
  40   1          g_lap_view_page = 0;
  41   1      }
  42          
  43          // 添加计次
  44          void Stopwatch_AddLap(void) {
  45   1          unsigned char hour, min, sec, ds;
  46   1          
  47   1          if(g_lap_count >= MAX_LAP_COUNT) {
  48   2              return;  // 已达最大计次数
  49   2          }
  50   1          
  51   1          Stopwatch_GetTime(&hour, &min, &sec, &ds);
  52   1          
  53   1          g_laps[g_lap_count].hour = hour;
  54   1          g_laps[g_lap_count].minute = min;
C51 COMPILER V9.60.7.0   STOPWATCH                                                         11/18/2025 22:05:12 PAGE 2   

  55   1          g_laps[g_lap_count].second = sec;
  56   1          g_laps[g_lap_count].decisecond = ds;
  57   1          g_lap_count++;
  58   1      }
  59          
  60          // 获取秒表时间
  61          void Stopwatch_GetTime(unsigned char *hour, unsigned char *min, unsigned char *sec, unsigned char *ds) {
  62   1          unsigned long value = g_stopwatch.ticks;   // 百分之一秒
  63   1      
  64   1          *ds = (unsigned char)((value / 10UL) % 10UL);  // 0.1秒
  65   1          value /= 100UL;                                 // 秒
  66   1          *sec = (unsigned char)(value % 60UL);
  67   1          value /= 60UL;                                  // 分
  68   1          *min = (unsigned char)(value % 60UL);
  69   1          value /= 60UL;                                  // 时
  70   1          if(value > 99UL) {
  71   2              value = 99UL;
  72   2          }
  73   1          *hour = (unsigned char)value;
  74   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    376    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      20
   IDATA SIZE       =     39    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
